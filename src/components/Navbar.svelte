<script>
  import { createEventDispatcher } from 'svelte';
  import Icon from '../routes/Icon.svelte';
  import { muted } from '../routes/store.js';
  
  // Always show menu button by removing the showBackButton prop
  // New props to check if user is in JAM or REWIND mode
  export let playingJam = false;
  export let playingRewind = false;
  
  const dispatch = createEventDispatcher();
  
  function handleMenuClick() {
    dispatch('menu');
  }
  
  function handleMute() {
    $muted = !$muted;
  }
  
  function handleHelpClick() {
    dispatch('help');
  }
  
  function handleStatsClick() {
    dispatch('stats');
  }
</script>

<div class="navbar-container">
<div class="navbar">
  <div class="navbar-left">
    <div class="icon-btn" on:click={handleMenuClick}>
      <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M25.7353 23.5882C26.3018 23.5885 26.8465 23.8067 27.2565 24.1977C27.6664 24.5886 27.9103 25.1223 27.9375 25.6881C27.9648 26.254 27.7733 26.8086 27.4027 27.2371C27.0321 27.6655 26.5109 27.935 25.9471 27.9897L25.7353 28H2.20588C1.63939 27.9997 1.09471 27.7815 0.684726 27.3906C0.274738 26.9996 0.0308647 26.466 0.00364079 25.9001C-0.0235831 25.3343 0.167929 24.7797 0.538493 24.3512C0.909057 23.9227 1.43027 23.6532 1.99412 23.5985L2.20588 23.5882H25.7353ZM25.7353 13.2941C26.3203 13.2941 26.8814 13.5265 27.2951 13.9402C27.7088 14.3539 27.9412 14.915 27.9412 15.5C27.9412 16.085 27.7088 16.6461 27.2951 17.0598C26.8814 17.4735 26.3203 17.7059 25.7353 17.7059H2.20588C1.62085 17.7059 1.05977 17.4735 0.646088 17.0598C0.232405 16.6461 0 16.085 0 15.5C0 14.915 0.232405 14.3539 0.646088 13.9402C1.05977 13.5265 1.62085 13.2941 2.20588 13.2941H25.7353ZM25.7353 3C26.3203 3 26.8814 3.2324 27.2951 3.64609C27.7088 4.05977 27.9412 4.62085 27.9412 5.20588C27.9412 5.79092 27.7088 6.35199 27.2951 6.76568C26.8814 7.17936 26.3203 7.41176 25.7353 7.41176H2.20588C1.62085 7.41176 1.05977 7.17936 0.646088 6.76568C0.232405 6.35199 0 5.79092 0 5.20588C0 4.62085 0.232405 4.05977 0.646088 3.64609C1.05977 3.2324 1.62085 3 2.20588 3H25.7353Z" fill="white"/>
        <circle cx="23" cy="5" r="5" fill="#FF6A00"/>
      </svg>
      <!-- <Icon width={"1.75rem"} height={"1.75rem"} name={"menu"}></Icon> -->
    </div>
    <!-- Show mode indicator icons based on current game mode -->
    {#if playingJam}
      <div class="mode-indicator jam-mode">
        <svg width="76" height="31" viewBox="0 0 76 31" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M24.0114 6.09091H29.071V19.054C29.0649 20.285 28.754 21.3684 28.1385 22.304C27.5291 23.2334 26.6858 23.9598 25.6087 24.483C24.5376 25 23.3035 25.2585 21.9062 25.2585C20.6937 25.2585 19.5857 25.0492 18.5824 24.6307C17.5791 24.206 16.7789 23.5412 16.1818 22.6364C15.5848 21.7254 15.2893 20.5436 15.2955 19.0909H20.429C20.4474 19.5649 20.5275 19.965 20.669 20.2912C20.8168 20.6174 21.0199 20.8636 21.2784 21.0298C21.5431 21.1899 21.8632 21.2699 22.2386 21.2699C22.6203 21.2699 22.9403 21.1868 23.1989 21.0206C23.4635 20.8544 23.6636 20.6082 23.799 20.282C23.9344 19.9496 24.0052 19.5402 24.0114 19.054V6.09091ZM36.4158 25H30.8761L37.1175 6.09091H44.1346L50.3761 25H44.8363L40.6999 11.2983H40.5522L36.4158 25ZM35.3817 17.5398H45.7965V21.3807H35.3817V17.5398ZM52.1973 6.09091H58.5865L62.9814 16.8011H63.2029L67.5978 6.09091H73.987V25H68.9643V14.0682H68.8166L64.6064 24.8523H61.5779L57.3677 13.9943H57.22V25H52.1973V6.09091Z" fill="#CBFF70"/>
          <path d="M16.7699 6.23169C16.6975 6.15825 16.6115 6.09998 16.5168 6.06022C16.4222 6.02046 16.3207 6 16.2182 6C16.1157 6 16.0142 6.02046 15.9195 6.06022C15.8248 6.09998 15.7388 6.15825 15.6664 6.23169L15.3225 6.57989C15.2952 6.60749 15.2735 6.64027 15.2587 6.67637C15.2439 6.71246 15.2363 6.75116 15.2363 6.79024C15.2363 6.82932 15.2439 6.86801 15.2587 6.90411C15.2735 6.9402 15.2952 6.97299 15.3225 7.00058L16.0116 7.69817C16.0388 7.72584 16.0712 7.74779 16.1069 7.76277C16.1425 7.77775 16.1808 7.78545 16.2194 7.78545C16.258 7.78545 16.2962 7.77775 16.3318 7.76277C16.3675 7.74779 16.3999 7.72584 16.4271 7.69817L16.7711 7.34997C17.0763 7.04099 17.0763 6.54186 16.7711 6.23288L16.7699 6.23169ZM13.8352 8.1153C13.8624 8.08763 13.8948 8.06568 13.9305 8.0507C13.9661 8.03572 14.0043 8.02801 14.0429 8.02801C14.0815 8.02801 14.1198 8.03572 14.1554 8.0507C14.1911 8.06568 14.2235 8.08763 14.2507 8.1153L14.9398 8.81288C14.9671 8.84048 14.9888 8.87327 15.0036 8.90936C15.0184 8.94546 15.026 8.98415 15.026 9.02323C15.026 9.06231 15.0184 9.101 15.0036 9.1371C14.9888 9.17319 14.9671 9.20598 14.9398 9.23358L14.2507 9.93116C14.2235 9.95883 14.1911 9.98078 14.1554 9.99576C14.1198 10.0107 14.0815 10.0184 14.0429 10.0184C14.0043 10.0184 13.9661 10.0107 13.9305 9.99576C13.8948 9.98078 13.8624 9.95883 13.8352 9.93116L13.1472 9.23358C13.1199 9.20598 13.0982 9.17319 13.0834 9.1371C13.0686 9.101 13.061 9.06231 13.061 9.02323C13.061 8.98415 13.0686 8.94546 13.0834 8.90936C13.0982 8.87327 13.1199 8.84048 13.1472 8.81288L13.8352 8.1153ZM12.0743 10.3495C12.047 10.3218 12.0146 10.2999 11.979 10.2849C11.9433 10.2699 11.9051 10.2622 11.8665 10.2622C11.8279 10.2622 11.7897 10.2699 11.754 10.2849C11.7184 10.2999 11.686 10.3218 11.6587 10.3495L9.86266 12.1677C9.83533 12.1953 9.81364 12.2281 9.79885 12.2642C9.78405 12.3003 9.77644 12.339 9.77644 12.3781C9.77644 12.4171 9.78405 12.4558 9.79885 12.4919C9.81364 12.528 9.83533 12.5608 9.86266 12.5884L10.5517 13.286C10.579 13.3137 10.6114 13.3356 10.647 13.3506C10.6827 13.3656 10.7209 13.3733 10.7595 13.3733C10.7981 13.3733 10.8363 13.3656 10.872 13.3506C10.9077 13.3356 10.94 13.3137 10.9673 13.286L12.7634 11.4678C12.7907 11.4402 12.8124 11.4074 12.8272 11.3713C12.842 11.3352 12.8496 11.2965 12.8496 11.2574C12.8496 11.2183 12.842 11.1796 12.8272 11.1435C12.8124 11.1074 12.7907 11.0747 12.7634 11.0471L12.0743 10.3495ZM8.22389 13.2135C8.11544 13.1031 7.98649 13.0154 7.84446 12.9556C7.70243 12.8958 7.55012 12.865 7.39628 12.865C7.24245 12.865 7.09014 12.8958 6.9481 12.9556C6.80607 13.0154 6.67712 13.1031 6.56868 13.2135L2.43653 17.3967C1.99755 17.8411 1.75093 18.4438 1.75093 19.0723C1.75093 19.3835 1.81147 19.6916 1.92911 19.9791C2.04675 20.2666 2.21917 20.5279 2.43653 20.7479C2.6539 20.968 2.91195 21.1425 3.19595 21.2616C3.47995 21.3807 3.78434 21.442 4.09174 21.442C4.71256 21.442 5.30796 21.1923 5.74695 20.7479L9.87909 16.5648C9.9882 16.455 10.0748 16.3245 10.1339 16.1807C10.193 16.0369 10.2234 15.8827 10.2234 15.727C10.2234 15.5712 10.193 15.417 10.1339 15.2733C10.0748 15.1295 9.9882 14.9989 9.87909 14.8891L8.22389 13.2135ZM1.48567 22.5186C1.55228 22.4765 1.60987 22.4213 1.65503 22.3563C1.70019 22.2912 1.73199 22.2177 1.74856 22.14C1.76513 22.0623 1.76613 21.982 1.7515 21.9039C1.73687 21.8258 1.7069 21.7514 1.66338 21.6853C1.61986 21.6191 1.56366 21.5624 1.49812 21.5187C1.43257 21.4749 1.35902 21.4448 1.28181 21.4304C1.20459 21.4159 1.12529 21.4172 1.0486 21.4343C0.97191 21.4514 0.899387 21.4839 0.835328 21.5299C-0.702488 22.5685 0.0229852 25 1.87189 25H11.7209C11.8766 25 12.0259 24.9374 12.136 24.826C12.2461 24.7145 12.3079 24.5634 12.3079 24.4058C12.3079 24.2482 12.2461 24.0971 12.136 23.9856C12.0259 23.8742 11.8766 23.8116 11.7209 23.8116H1.87189C1.18515 23.8116 0.915153 22.9096 1.48684 22.5281L1.48567 22.5186Z" fill="#CBFF70"/>
        </svg>
      </div>
    {/if}
    
    {#if playingRewind}
      <div class="mode-indicator rewind-mode">
        <svg width="130" height="31" viewBox="0 0 130 31" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M23.2188 25V6.09091H31.3807C32.7841 6.09091 34.0121 6.34635 35.0646 6.85724C36.1172 7.36813 36.9358 8.10369 37.5206 9.06392C38.1054 10.0241 38.3977 11.1752 38.3977 12.517C38.3977 13.8712 38.0961 15.013 37.4929 15.9425C36.8958 16.8719 36.0556 17.5736 34.9723 18.0476C33.8951 18.5215 32.6364 18.7585 31.196 18.7585H26.321V14.7699H30.1619C30.7652 14.7699 31.2791 14.696 31.7038 14.5483C32.1347 14.3944 32.464 14.1513 32.6918 13.8189C32.9257 13.4865 33.0426 13.0526 33.0426 12.517C33.0426 11.9754 32.9257 11.5353 32.6918 11.1967C32.464 10.852 32.1347 10.5997 31.7038 10.4396C31.2791 10.2734 30.7652 10.1903 30.1619 10.1903H28.3523V25H23.2188ZM34.2983 16.321L39.0256 25H33.4489L28.8324 16.321H34.2983ZM40.5859 25V6.09091H54.2138V10.2273H45.7195V13.4773H53.5121V17.6136H45.7195V20.8636H54.1768V25H40.5859ZM61.5609 25L55.9842 6.09091H61.7086L64.2939 17.7244H64.4416L67.5069 6.09091H72.0126L75.0779 17.7614H75.2257L77.8109 6.09091H83.5353L77.9586 25H73.0467L69.8336 14.4375H69.6859L66.4728 25H61.5609ZM90.3308 6.09091V25H85.1973V6.09091H90.3308ZM109.124 6.09091V25H104.84L98.008 15.0653H97.8972V25H92.7637V6.09091H97.1216L103.843 15.9886H103.991V6.09091H109.124ZM118.828 25H111.553V6.09091H118.754C120.7 6.09091 122.38 6.46946 123.796 7.22656C125.218 7.97751 126.313 9.06084 127.083 10.4766C127.858 11.8861 128.246 13.5758 128.246 15.5455C128.246 17.5152 127.861 19.2079 127.092 20.6236C126.322 22.0331 125.233 23.1165 123.823 23.8736C122.414 24.6245 120.749 25 118.828 25ZM116.686 20.642H118.644C119.579 20.642 120.376 20.4912 121.035 20.1896C121.7 19.888 122.204 19.3679 122.549 18.6293C122.9 17.8906 123.075 16.8627 123.075 15.5455C123.075 14.2282 122.897 13.2003 122.54 12.4616C122.189 11.723 121.672 11.2029 120.989 10.9013C120.312 10.5997 119.481 10.4489 118.496 10.4489H116.686V20.642Z" fill="#CBFF70"/>
          <path d="M10.7401 14.0024L19.2805 7.09408C19.3502 7.03779 19.4312 7.0055 19.5149 7.00064C19.5985 6.99579 19.6817 7.01855 19.7555 7.06651C19.8294 7.11447 19.8911 7.18583 19.9342 7.27299C19.9772 7.36015 20 7.45984 20 7.56145V23.4385C20 23.5402 19.9772 23.6399 19.9342 23.727C19.8911 23.8142 19.8294 23.8855 19.7555 23.9335C19.6817 23.9814 19.5985 24.0042 19.5149 23.9994C19.4312 23.9945 19.3502 23.9622 19.2805 23.9059L10.7401 16.9976V23.4385C10.7401 23.5402 10.7173 23.6399 10.6743 23.727C10.6312 23.8142 10.5695 23.8855 10.4957 23.9335C10.4219 23.9814 10.3387 24.0042 10.255 23.9994C10.1714 23.9945 10.0904 23.9622 10.0207 23.9059L0.206136 15.9674C0.142725 15.9161 0.0907332 15.8466 0.0547739 15.765C0.0188146 15.6835 0 15.5925 0 15.5C0 15.4075 0.0188146 15.3165 0.0547739 15.235C0.0907332 15.1534 0.142725 15.0839 0.206136 15.0326L10.0207 7.09408C10.0904 7.03779 10.1714 7.0055 10.255 7.00064C10.3387 6.99579 10.4219 7.01855 10.4957 7.06651C10.5695 7.11447 10.6312 7.18583 10.6743 7.27299C10.7173 7.36015 10.7401 7.45984 10.7401 7.56145V14.0024Z" fill="#CBFF70"/>
        </svg>
      </div>
    {/if}
  </div>
  
  <div class="navbar-right">
    <div class="icon-btn" on:click={handleStatsClick}>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 12H6V22H2V12Z" fill="white"/>
        <path d="M10 8H14V22H10V8Z" fill="white"/>
        <path d="M18 3H22V22H18V3Z" fill="white"/>
      </svg>
    </div>
    {#if $muted}
      <div class="icon-btn" on:click={handleMute}>
        <Icon width={"1.75rem"} height={"1.75rem"} name={"muted"}></Icon>
      </div>
    {:else}
      <div class="icon-btn" on:click={handleMute}>
        <Icon width={"1.75rem"} height={"1.75rem"} name={"unmuted"}></Icon>
      </div>
    {/if}
    <div class="icon-btn" on:click={handleHelpClick}>
      <Icon width={"1.75rem"} height={"1.75rem"} name={"help"}></Icon>
    </div>
  </div>
</div>
</div>

<style>
.navbar-container {
  position: sticky;
  top: 50px; /* Leave space for the ad above */
  width: 100%;
  height: 50px;
  background-color: #121212;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  z-index: 100;
  margin-bottom: 15px; /* Add bottom margin for spacing */
}

.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  max-width: 100%;
  height: 100%;
  padding: 0 15px;
}

.navbar-left, .navbar-right {
  display: flex;
  align-items: center;
}

/* Added styles for navbar-left to properly align the mode indicators */
.navbar-left {
  gap: 12px; /* Add spacing between menu button and mode indicator */
}

.icon-btn {
  margin: 0 7.5px;
  cursor: pointer;
}

/* Style for the NEW feature button - add a pulse animation to draw attention */
/* .new-feature-btn {
  position: relative;
  animation: pulse 2s infinite;
} */

@keyframes pulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

.navbar-right {
  display: flex;
  justify-content: flex-end;
}

/* Desktop styles */
@media (min-width: 768px) {
  .navbar {
    max-width: 800px;
    margin: 0 auto;
  }
}

@media (min-width: 768px) {
  .navbar-container {
    top: 0;
    padding-top: 2.5px;
  }
}
</style>